<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Governorate;
use App\Models\City;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class GovernorateSeeder extends Seeder
{
    public function run(): void
    {
        try {
            DB::beginTransaction();

            $data = [
                'القاهرة' => ['القاهرة الجديدة'],

                // 'القاهرة' => ['القاهرة الجديدة', 'مدينة نصر', 'المعادي', 'حلوان', 'شبرا', 'مصر الجديدة', 'العباسية', 'السيدة زينب'],
                // 'الجيزة' => ['السادس من أكتوبر', 'الشيخ زايد', 'الهرم', 'فيصل', 'الدقي', 'العجوزة', 'إمبابة', 'بولاق الدكرور'],
                // 'الإسكندرية' => ['المنتزه', 'العامرية', 'الرمل', 'سيدي جابر', 'محرم بك', 'اللبان', 'العطارين'],
                // 'الشرقية' => ['الزقازيق', 'العاشر من رمضان', 'بلبيس', 'منيا القمح', 'فاقوس'],
                // 'الدقهلية' => ['المنصورة', 'طلخا', 'ميت غمر', 'دكرنس', 'أجا'],
                // 'البحيرة' => ['دمنهور', 'كفر الدوار', 'رشيد', 'إدكو', 'أبو حمص'],
                // 'الغربية' => ['طنطا', 'المحلة الكبرى', 'كفر الزيات', 'السنطة', 'زفتى'],
                // 'المنوفية' => ['شبين الكوم', 'منوف', 'السادات', 'قويسنا', 'أشمون'],
                // 'القليوبية' => ['بنها', 'قليوب', 'شبرا الخيمة', 'القناطر الخيرية', 'الخانكة'],
                // 'كفر الشيخ' => ['كفر الشيخ', 'دسوق', 'فوه', 'بيلا', 'الحامول'],
                // 'الفيوم' => ['الفيوم', 'إبشواي', 'سنورس', 'طامية', 'يوسف الصديق'],
                // 'بني سويف' => ['بني سويف', 'الواسطى', 'ناصر', 'إهناسيا', 'ببا'],
                // 'المنيا' => ['المنيا', 'ملوي', 'سمالوط', 'مغاغة', 'أبو قرقاص'],
                // 'أسيوط' => ['أسيوط', 'أبو تيج', 'الغنايم', 'ديروط', 'القوصية'],
                // 'سوهاج' => ['سوهاج', 'أخميم', 'طهطا', 'جرجا', 'البلينا'],
                // 'قنا' => ['قنا', 'نجع حمادي', 'دشنا', 'الوقف', 'قوص'],
                // 'الأقصر' => ['الأقصر', 'إسنا', 'أرمنت', 'القرنة'],
                // 'أسوان' => ['أسوان', 'كوم أمبو', 'إدفو', 'نصر النوبة'],
                // 'البحر الأحمر' => ['الغردقة', 'سفاجا', 'القصير', 'رأس غارب', 'مرسى علم'],
                // 'الوادي الجديد' => ['الخارجة', 'الداخلة', 'الفرافرة', 'باريس'],
                // 'مطروح' => ['مرسى مطروح', 'العلمين', 'الحمام', 'الضبعة', 'سيوة'],
                // 'شمال سيناء' => ['العريش', 'بئر العبد', 'الشيخ زويد', 'رفح'],
                // 'جنوب سيناء' => ['الطور', 'شرم الشيخ', 'دهب', 'نويبع', 'سانت كاترين'],
                // 'الإسماعيلية' => ['الإسماعيلية', 'فايد', 'القنطرة شرق', 'القنطرة غرب'],
                // 'السويس' => ['السويس', 'عتاقة', 'الجناين'],
                // 'بورسعيد' => ['بورفؤاد', 'الشرق', 'الغرب', 'الضواحي'],
                // 'دمياط' => ['دمياط', 'رأس البر', 'فارسكور', 'الزرقا', 'كفر سعد'],
            ];

            foreach ($data as $governorateName => $cities) {
                $governorate = Governorate::firstOrCreate(['name' => $governorateName]);

                foreach ($cities as $cityName) {
                    City::firstOrCreate([
                        'governorate_id' => $governorate->id,
                        'name' => $cityName,
                    ]);
                }
            }

            DB::commit();

            $this->command->info('Governorates and cities seeded successfully!');

        } catch (\Exception $e) {
            DB::rollBack();
            Log::error('GovernorateSeeder failed: ' . $e->getMessage());
            $this->command->error('Failed to seed governorates: ' . $e->getMessage());
        }
    }
}
